# -*- coding: utf-8 -*-
"""IISC CISTUP test 1 question 2 .ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1ypZX5nsc-CL5xLMFHO3tgMEby9BRjrK3
"""

from google.colab import files
uploaded = files.upload()

import pandas as pd
from geopy.distance import distance
from multiprocessing import Pool, cpu_count

def calculate_distance(df):
    total_distance = 0
    for i in range(len(df)-1):
        curr_loc = (df.iloc[i]['latitude'], df.iloc[i]['longitude'])
        next_loc = (df.iloc[i+1]['latitude'], df.iloc[i+1]['longitude'])
        total_distance += distance(curr_loc, next_loc).meters
    return total_distance

def calculate_total_distance(df):
    results = {}
    grouped = df.groupby('individual_id')
    with Pool(cpu_count()) as p:
        distances = p.map(calculate_distance, [grouped.get_group(x) for x in grouped.groups])
    for i, ind_id in enumerate(grouped.groups):
        results[ind_id] = distances[i]
    return results

df = pd.read_csv('truncated_uoto_2.csv')
distances = calculate_total_distance(df)
print(distances)

df #taken small portion of the massive dataset given that;s why only 1 unique individual_id is their
